@property --_p {
  syntax: "<angle>";
  initial-value: 1turn;
  inherits: false;
}

.logo {
  --b: 1px; /* the border thickness */
  --g: 5%; /* control the gap */
  width: 23px; /* control the size */
  aspect-ratio: 1;
  display: inline-grid;
  margin-left: 25px;
  --_d: calc(100% / (2 * sin(22.5deg)) + var(--g));
}

.logo i {
  grid-area: 1/1;
  background: rgba(100, 100, 100, 0.3);

  /* start centered, matching the 0% keyframe */
  transform: rotate(calc(var(--i) * 45deg + 22.5deg)) translate(0)
             rotate(calc(var(--i) * -45deg - 22.5deg));
  --o: calc(50% * tan(-22.5deg));
  clip-path: polygon(
    var(--o) 50%,
    50% var(--o),
    calc(100% - var(--o)) 50%,
    50% calc(100% - var(--o))
  );
  animation: move 2s 1s linear both;
  will-change: transform;
}

@keyframes move {
  0% {
    transform: rotate(calc(var(--i) * 45deg + 22.5deg)) translate(0)
      rotate(calc(var(--i) * -45deg - 22.5deg));
    background: rgba(100, 100, 100, 0.3);
  }
  50%, 100% {
    transform: rotate(calc(var(--i) * 45deg + 22.5deg)) translate(var(--_d))
      rotate(calc(var(--i) * -45deg - 22.5deg));
    background: #D1D1D1;
  }
}

.logo:after {
  content: "";
  grid-area: 1/1;
  background: white;
  margin: calc(50% - (var(--_d) + var(--b) / 2) * cos(22.5deg));
  mask: conic-gradient(from 22.5deg, #000 var(--_p), #0000 0);
  animation: fill 2s 1s linear both;
  --o: calc(50% * tan(-22.5deg));
  --x: calc(var(--b) * cos(22.5deg));
  --y: calc(var(--b) * sin(22.5deg));
  clip-path: polygon(
    var(--o) 50%,
    50% var(--o),
    calc(100% - var(--o)) 50%,
    50% calc(100% - var(--o)),
    var(--o) 50%,
    calc(50% + var(--o) + var(--y)) var(--x),
    var(--x) calc(50% + var(--o) + var(--y)),
    var(--x) calc(50% - var(--o) - var(--y)),
    calc(50% + var(--o) + var(--y)) calc(100% - var(--x)),
    calc(50% - var(--o) - var(--y)) calc(100% - var(--x)),
    calc(100% - var(--x)) calc(50% - var(--o) - var(--y)),
    calc(100% - var(--x)) calc(50% + var(--o) + var(--y)),
    calc(50% - var(--o) - var(--y)) var(--x),
    calc(50% + var(--o) + var(--y)) var(--x)
  );
}

@keyframes fill {
  0%, 50% {
    --_p: 0deg;
  }
  100% {
    --_p: 360deg;
  }
}

.logo i:nth-child(1) {--i:1}
.logo i:nth-child(2) {--i:2}
.logo i:nth-child(3) {--i:3}
.logo i:nth-child(4) {--i:4}
.logo i:nth-child(5) {--i:5}
.logo i:nth-child(6) {--i:6}
.logo i:nth-child(7) {--i:7}
.logo i:nth-child(8) {--i:8}

/* =========================
   Ready state (after initial animation)
========================= */
.logo.ready i {
  transform: rotate(calc(var(--i) * 45deg + 22.5deg)) translate(var(--_d))
             rotate(calc(var(--i) * -45deg - 22.5deg));
  animation: none;
  background: transparent;
  clip-path: none;
  position: relative;
}

/* Shadow octagon (behind, darker) */
.logo.ready i::before {
  content: "";
  position: absolute;
  inset: 0;
  background: #6D6D6D;
  z-index: 1;
  --o: calc(50% * tan(-22.5deg));
  clip-path: polygon(
    var(--o) 50%,
    50% var(--o),
    calc(100% - var(--o)) 50%,
    50% calc(100% - var(--o))
  );
  animation: shadowOffset 1s ease-out forwards;
}

/* Main octagon (on top) */
.logo.ready i::after {
  content: "";
  position: absolute;
  inset: 0;
  background: #D1D1D1;
  z-index: 2;
  --o: calc(50% * tan(-22.5deg));
  clip-path: polygon(
    var(--o) 50%,
    50% var(--o),
    calc(100% - var(--o)) 50%,
    50% calc(100% - var(--o))
  );
}

@keyframes shadowOffset {
  from {
    transform: translate(0, 0);
  }
  to {
    transform: translate(1px, 1px);
  }
}

.logo.ready:after {
  --_p: 360deg;
  animation: none;
}

/* =========================
   Hover animation (reverse and expand)
========================= */
.logo.animating i {
  transform: rotate(calc(var(--i) * 45deg + 22.5deg)) translate(var(--_d))
             rotate(calc(var(--i) * -45deg - 22.5deg));
  animation: moveHover 5s linear both;
  background: transparent;
  clip-path: none;
  position: relative;
}

/* Shadow octagon during hover - animate back first */
.logo.animating i::before {
  content: "";
  position: absolute;
  inset: 0;
  background: #6D6D6D;
  z-index: 1;
  --o: calc(50% * tan(-22.5deg));
  clip-path: polygon(
    var(--o) 50%,
    50% var(--o),
    calc(100% - var(--o)) 50%,
    50% calc(100% - var(--o))
  );
  animation: shadowHover 5s linear both;
}

/* Main octagon during hover */
.logo.animating i::after {
  content: "";
  position: absolute;
  inset: 0;
  background: #D1D1D1;
  z-index: 2;
  --o: calc(50% * tan(-22.5deg));
  clip-path: polygon(
    var(--o) 50%,
    50% var(--o),
    calc(100% - var(--o)) 50%,
    50% calc(100% - var(--o))
  );
}

@keyframes shadowHover {
  0% {
    transform: translate(1px, 1px);
  }
  10%, 90% {
    transform: translate(0, 0);
  }
  100% {
    transform: translate(1px, 1px);
  }
}

@keyframes moveHover {
  0%, 10% {
    transform: rotate(calc(var(--i) * 45deg + 22.5deg)) translate(var(--_d))
      rotate(calc(var(--i) * -45deg - 22.5deg));
  }
  50% {
    transform: rotate(calc(var(--i) * 45deg + 22.5deg)) translate(0)
      rotate(calc(var(--i) * -45deg - 22.5deg));
  }
  90%, 100% {
    transform: rotate(calc(var(--i) * 45deg + 22.5deg)) translate(var(--_d))
      rotate(calc(var(--i) * -45deg - 22.5deg));
  }
}

.logo.animating:after {
  animation: fillHover 5s linear both;
}

@keyframes fillHover {
  0% {
    --_p: 360deg;
  }
  10%, 90% {
    --_p: 0deg;
  }
  100% {
    --_p: 360deg;
  }
}

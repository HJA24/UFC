@property --_p {
  syntax: "<angle>";
  initial-value: 1turn;
  inherits: false;
}

.logo {
  --b: 1px; /* the border thickness */
  --g: 5%; /* control the gap */
  width: 23px; /* control the size */
  aspect-ratio: 1;
  display: inline-grid;
  margin-left: 25px;
  --_d: calc(100% / (2 * sin(22.5deg)) + var(--g));
}

.logo i {
  grid-area: 1/1;
  background: rgba(100, 100, 100, 0.3);

  /* start centered, matching the 0% keyframe */
  transform: rotate(calc(var(--i) * 45deg + 22.5deg)) translate(0)
             rotate(calc(var(--i) * -45deg - 22.5deg));
  --o: calc(50% * tan(-22.5deg));
  clip-path: polygon(
    var(--o) 50%,
    50% var(--o),
    calc(100% - var(--o)) 50%,
    50% calc(100% - var(--o))
  );
  animation: move 2s 1s linear both;
  will-change: transform;
}

@keyframes move {
  0% {
    transform: rotate(calc(var(--i) * 45deg + 22.5deg)) translate(0)
      rotate(calc(var(--i) * -45deg - 22.5deg));
    background: rgba(100, 100, 100, 0.3);
  }
  50%, 100% {
    transform: rotate(calc(var(--i) * 45deg + 22.5deg)) translate(var(--_d))
      rotate(calc(var(--i) * -45deg - 22.5deg));
    background: #D1D1D1;
  }
}

.logo:after {
  content: "";
  grid-area: 1/1;
  background: white;
  margin: calc(50% - (var(--_d) + var(--b) / 2) * cos(22.5deg));
  mask: conic-gradient(from 22.5deg, #000 var(--_p), #0000 0);
  animation: fill 2s 1s linear both;
  --o: calc(50% * tan(-22.5deg));
  --x: calc(var(--b) * cos(22.5deg));
  --y: calc(var(--b) * sin(22.5deg));
  clip-path: polygon(
    var(--o) 50%,
    50% var(--o),
    calc(100% - var(--o)) 50%,
    50% calc(100% - var(--o)),
    var(--o) 50%,
    calc(50% + var(--o) + var(--y)) var(--x),
    var(--x) calc(50% + var(--o) + var(--y)),
    var(--x) calc(50% - var(--o) - var(--y)),
    calc(50% + var(--o) + var(--y)) calc(100% - var(--x)),
    calc(50% - var(--o) - var(--y)) calc(100% - var(--x)),
    calc(100% - var(--x)) calc(50% - var(--o) - var(--y)),
    calc(100% - var(--x)) calc(50% + var(--o) + var(--y)),
    calc(50% - var(--o) - var(--y)) var(--x),
    calc(50% + var(--o) + var(--y)) var(--x)
  );
}

@keyframes fill {
  0%, 50% {
    --_p: 0deg;
  }
  100% {
    --_p: 360deg;
  }
}

.logo i:nth-child(1) {--i:1}
.logo i:nth-child(2) {--i:2}
.logo i:nth-child(3) {--i:3}
.logo i:nth-child(4) {--i:4}
.logo i:nth-child(5) {--i:5}
.logo i:nth-child(6) {--i:6}
.logo i:nth-child(7) {--i:7}
.logo i:nth-child(8) {--i:8}

/* =========================
   Ready state (after initial animation)
========================= */
.logo.ready i {
  transform: rotate(calc(var(--i) * 45deg + 22.5deg)) translate(var(--_d))
             rotate(calc(var(--i) * -45deg - 22.5deg));
  animation: none;
  background: transparent;
  clip-path: none;
  position: relative;
}

/* Shadow octagon - base (hidden during init) */
.logo i::before {
  content: "";
  position: absolute;
  inset: 0;
  background: #6D6D6D;
  z-index: 1;
  --o: calc(50% * tan(-22.5deg));
  clip-path: polygon(
    var(--o) 50%,
    50% var(--o),
    calc(100% - var(--o)) 50%,
    50% calc(100% - var(--o))
  );
  transform: translate(0, 0);
  opacity: 0;
  transition: transform 1s ease-out 3s, opacity 0s 3s;
}

/* Shadow octagon - ready (visible, slides out via transition) */
.logo.ready i::before {
  transform: translate(1px, 1px);
  opacity: 1;
  transition: transform 1s ease-out, opacity 0s;
}

/* Main octagon (on top) */
.logo.ready i::after {
  content: "";
  position: absolute;
  inset: 0;
  background: #D1D1D1;
  z-index: 2;
  --o: calc(50% * tan(-22.5deg));
  clip-path: polygon(
    var(--o) 50%,
    50% var(--o),
    calc(100% - var(--o)) 50%,
    50% calc(100% - var(--o))
  );
}

.logo.ready:after {
  --_p: 360deg;
  animation: none;
}

/* =========================
   Hover animation (4 components, 6s total)
   1. 0-1s (0-16.7%): Shadow slides back
   2. 1-2s (16.7-33.3%): Line reverts + color darkens
   3. 2-3s (33.3-50%): Octagons collapse to center
   4. 3-6s (50-100%): Init effect (expand + line + shadow)
========================= */
.logo.animating i {
  transform: rotate(calc(var(--i) * 45deg + 22.5deg)) translate(var(--_d))
             rotate(calc(var(--i) * -45deg - 22.5deg));
  animation: hover-move 6s linear both;
  background: transparent;
  clip-path: none;
  position: relative;
}

.logo.animating i::before {
  content: "";
  position: absolute;
  inset: 0;
  background: #6D6D6D;
  z-index: 1;
  --o: calc(50% * tan(-22.5deg));
  clip-path: polygon(
    var(--o) 50%,
    50% var(--o),
    calc(100% - var(--o)) 50%,
    50% calc(100% - var(--o))
  );
  animation: hover-shadow 6s linear both;
}

.logo.animating i::after {
  content: "";
  position: absolute;
  inset: 0;
  z-index: 2;
  --o: calc(50% * tan(-22.5deg));
  clip-path: polygon(
    var(--o) 50%,
    50% var(--o),
    calc(100% - var(--o)) 50%,
    50% calc(100% - var(--o))
  );
  animation: hover-color 6s linear both;
}

.logo.animating:after {
  animation: hover-line 6s linear both;
}

/* Component 1: Shadow slides back (0-16.7%), instantly hidden at 16.7%, slides out (83.3-100%) */
@keyframes hover-shadow {
  0% {
    transform: translate(1px, 1px);
    opacity: 1;
    visibility: visible;
    background: #6D6D6D;
  }
  15.7% {
    transform: translate(0, 0);
    opacity: 1;
    visibility: visible;
    background: #6D6D6D;
  }
  16.7%, 83.3% {
    transform: translate(0, 0);
    opacity: 0;
    visibility: hidden;
    background: transparent;
  }
  100% {
    transform: translate(1px, 1px);
    opacity: 1;
    visibility: visible;
    background: #6D6D6D;
  }
}

/* Component 2: Line reverts (16.7-33.3%) then draws (66.7-83.3%) */
@keyframes hover-line {
  0%, 16.7% {
    --_p: 360deg;
  }
  33.3%, 66.7% {
    --_p: 0deg;
  }
  83.3%, 100% {
    --_p: 360deg;
  }
}

/* Component 3: Octagons collapse (33.3-50%) then expand (50-66.7%) */
@keyframes hover-move {
  0%, 33.3% {
    transform: rotate(calc(var(--i) * 45deg + 22.5deg)) translate(var(--_d))
      rotate(calc(var(--i) * -45deg - 22.5deg));
  }
  50% {
    transform: rotate(calc(var(--i) * 45deg + 22.5deg)) translate(0)
      rotate(calc(var(--i) * -45deg - 22.5deg));
  }
  66.7%, 100% {
    transform: rotate(calc(var(--i) * 45deg + 22.5deg)) translate(var(--_d))
      rotate(calc(var(--i) * -45deg - 22.5deg));
  }
}

/* Component 2+3: Color darkens with line (16.7-33.3%) then lightens with expand (50-66.7%) */
@keyframes hover-color {
  0%, 16.7% {
    background: #D1D1D1;
  }
  33.3%, 50% {
    background: rgba(100, 100, 100, 0.3);
  }
  66.7%, 100% {
    background: #D1D1D1;
  }
}
